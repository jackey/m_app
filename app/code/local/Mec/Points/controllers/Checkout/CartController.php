<?php// require_once "Mage/Checkout/controllers/CartController.php"; require_once(Mage::getModuleDir('controllers', 'Mage_Checkout').'/CartController.php');class Mec_Points_Checkout_CartController extends Mage_Checkout_CartController{	 protected function _updateShoppingCart()    {        try {            $cartData = $this->getRequest()->getParam('cart');						$can_update = Mage::helper('points')->CanUpdateGiftProduct($cartData);			if($can_update) {				if (is_array($cartData)) {                $filter = new Zend_Filter_LocalizedToNormalized(                    array('locale' => Mage::app()->getLocale()->getLocaleCode())                );                foreach ($cartData as $index => $data) {                    if (isset($data['qty'])) {                        $cartData[$index]['qty'] = $filter->filter(trim($data['qty']));                    }                }                $cart = $this->_getCart();                if (! $cart->getCustomerSession()->getCustomer()->getId() && $cart->getQuote()->getCustomerId()) {                    $cart->getQuote()->setCustomerId(null);                }                $cartData = $cart->suggestItemsQty($cartData);                $cart->updateItems($cartData)                    ->save();				}				 $this->_getSession()->setCartWasUpdated(true);			}else{				 $this->_getSession()->addError(Mage::helper('core')->escapeHtml($this->__('Your Points Not Enough To Update Cart')));			}                     } catch (Mage_Core_Exception $e) {            $this->_getSession()->addError(Mage::helper('core')->escapeHtml($e->getMessage()));        } catch (Exception $e) {            $this->_getSession()->addException($e, $this->__('Cannot update shopping cart.'));            Mage::logException($e);        }    }}